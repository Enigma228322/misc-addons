<odoo>
    <record id="ohada_dash_kanban_view" model="ir.ui.view">
        <field name="name">ohada.dash.dashboard.kanban</field>
        <field name="model">ohada.dash</field>
        <field name="arch" type="xml">
            <kanban class="oe_background_grey o_kanban_dashboard o_account_kanban">
                <field name="id"/>
                <field name="name"/>
                <field name="type"/>
                <field name="color"/>
                <field name="report_id"/>
                <field name="report_type"/>
                <field name="show_on_dashboard"/>
                <field name="display_name"/>
                <field name="company_id"/>
                <field name="currency_id"/>
                <field name="dash_size"/>
                <field name="reports"/>
                <field name="current_year"/>
                <field name="lines_value"/>
                <field name="name_to_display"/>
                <templates>
                    <t t-name="kanban-box">
                        <t t-value="JSON.parse(record.reports.raw_value)" t-set="reports_list"/>
                        <t t-value="JSON.parse(record.lines_value.raw_value)" t-set="lines"/>
                        <t t-value="record.name.raw_value" t-set="kanban_name"/>
                        <t t-value="record.name_to_display.raw_value" t-set="name_type"/>
                        <t t-value="record.dash_size.raw_value" t-set="dash_size"/>
                        <t t-value="record.type.raw_value" t-set="button_type"/>
                        <t t-value="record.current_year.raw_value" t-set="year"/>
                        <t t-value="record.report_type.raw_value" t-set="journal_type"/>
                        <t t-value="record.currency_id.raw_value" t-set="currency_symbol"/>
                        <t t-value="record.reports.raw_value" t-set="report_ids"/>
                        <t t-value="record.display_name.raw_value" t-set="dashboard"/>
                        <t t-if="dash_size == 'middle'" t-call="MiddleSizeBox"/>
                        <t t-if="dash_size == 'small'" t-call="SmallSizeBox"/>
                        <t t-if="dash_size == 'large'" t-call="LargeSizeBox"/>
                    </t>

                    <t t-name="LargeSizeBox">
                        <div t-attf-class="#{kanban_color(record.color.raw_value)} col-12 large-block">
                            <t t-call="JournalTop"/>
                            <div class="container o_kanban_card_content col-12">
                                <div class="row margin-left-0">
                                    <t t-if="kanban_name == 'Annexed Notes'" t-call="NoteButtons"/>
                                    <t t-if="kanban_name == 'Cover Page and Data Sheets'" t-call="Sheets"/>
                                    <t t-if="name_type == 'company'">
                                        <div class="col-sm-12 col-md-12 col-lg-12">
                                            <div class="oh-card no-border">
                                                <div class="oh-card-body pb-0 pad-top-5 pad-bot-20">
                                                    <div class="col-md-5 col-lg-5 marg-left-10 fl-left">
                                                    </div>
                                                    <div class="col-md-3 col-lg-3">
                                                        <img t-att-src="'/ohada_reports/static/img/ohada.png'"
                                                        class="company-img company-logo"/>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-4 col-lg-4 max-width-30">
                                                        <t t-call="ExportButtons"/>
                                                    </div>
                                                    <div class="col-md-4 col-lg-4">
                                                        <t t-call="CompanyLines"/>
                                                    </div>
                                                    <div class="col-md-4 col-lg-4">
                                                        <t t-call="CompanyStatus"/>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </t>
                                </div>
                            </div>
                            <div class="container o_kanban_card_manage_pane dropdown-menu" role="menu">
                                <t t-if="button_type == 'report'" t-call="ReportLook"/>
                                <t t-if="button_type == 'mix'" t-call="MixLook"/>
                                <t t-if="button_type != 'mix' and button_type != 'report'" t-call="Colors"/>
                            </div>
                        </div>
                    </t>

                    <t t-name="MiddleSizeBox">
                        <div t-attf-class="#{kanban_color(record.color.raw_value)} col-6">
                            <t t-call="JournalTop"/>
                            <div class="container o_kanban_card_manage_pane dropdown-menu" role="menu">
                                <t t-call="JournalManage"/>
                            </div>
                        </div>
                    </t>

                    <t t-name="SmallSizeBox">
                        <div t-attf-class="#{kanban_color(record.color.raw_value)} col-4 small-block">
                            <t t-call="JournalTop"/>
                            <div class="container o_kanban_card_content">
                                <div class="row">
                                    <t t-if="journal_type == 'BS'">
                                        <t t-call="JournalBS"/>
                                        <t t-call="OpenButton"/>
                                    </t>
                                    <t t-if="journal_type == 'PL'">
                                        <t t-call="JournalPL"/>
                                        <t t-call="OpenButton"/>
                                    </t>
                                    <t t-if="journal_type == 'CF'">
                                        <t t-call="JournalCF"/>
                                        <t t-call="OpenButton"/>
                                    </t>
                                </div>
                                <t t-if="journal_type == 'BS' || journal_type == 'PL' || journal_type == 'CF'" t-call="JournalBodyGraph"/>
                            </div>
                            <div class="container o_kanban_card_manage_pane dropdown-menu" role="menu">
                                <t t-if="button_type == 'report'" t-call="ReportLook"/>
                                <t t-if="button_type == 'mix'" t-call="MixLook"/>
                            </div>
                            <t t-call="JournalBodyGraph"/>
                        </div>
                    </t>

                    <t t-name="NoteButtons">
                        <t t-foreach="reports_list" t-as="note">
                            <div class="pad-left-6">
                                <button type="object" name="open_action_by_id" t-attf-data-context="{'id' : '#{note['id']}'}" class="btn btn-primary note btn-min-width">
                                    <span><t t-esc="note['name']"/></span>
                                </button>
                            </div>
                        </t>
                    </t>

                    <t t-name="Sheets">
                        <div class="pad-left-6 pad-bot-20">
                            <button type="object" name="open_action" class="btn btn-primary btn-min-width">
                                <span>COVER PAGE</span>
                            </button>
                        </div>
                        <t t-foreach="reports_list" t-as="sheet">
                            <div class="pad-left-6 pad-bot-20">
                                <button type="object" name="open_action_by_id" t-attf-data-context="{'id' : '#{sheet['id']}'}" class="btn btn-primary note btn-min-width">
                                    <span><t t-esc="sheet['name']"/></span>
                                </button>
                            </div>
                        </t>
                    </t>

                    <t t-name="ExportButtons">
                        <div class="ohada_notification pad-right-25 marg-left-minus-10 mrg-top-0px">
                            <div class="pad-left-0">
                                <button class="btn btn-primary oh_dashbard_btn_m marg-right-4 max-width-48">IMPORT DATA</button>
                                <button name="%(print_bundle_wizard)d" type="action" class="btn btn-primary oh_dashbard_btn_m print_bundle export marg-right-4 max-width-48">PRINT BUNDLE</button>
                                <button class="btn btn-primary oh_dashbard_btn_m marg-right-4 max-width-48">CLOSE PERIOD</button>
                                <button class="btn btn-primary oh_dashbard_btn_m marg-right-4 max-width-48">SIGN &amp; PAY</button>
                            </div>
                        </div>
                    </t>

                    <t t-name="CompanyLines">
                        <t t-foreach="lines['block_2']" t-as="line">
                            <div class="row">
                                <div class="col-7">
                                    <a type="object" name="open_action">
                                        <span><t t-esc="line['name']"/></span>
                                    </a>
                                </div>
                                <div class="col-5 text-right">
                                    <t t-esc="line['value']"/> <t t-esc="currency_symbol"/>
                                </div>
                            </div>
                        </t>
                    </t>

                    <t t-name="CompanyStatus">
                        <div class="row">
                            <div class="col-7">
                                <a type="object" name="open_action">
                                    <span>Status of fiscal year</span>
                                </a>
                            </div>
                            <div class="col-5 text-right">
                                <t t-esc="lines['period_lock_status']"/>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-7">
                                <a type="object" name="open_action">
                                    <span>Status of journal entries</span>
                                </a>
                            </div>
                            <div class="col-5 text-right">
                                <t t-esc="lines['unposted_in_period']"/>
                            </div>
                        </div>
                    </t>

                    <t t-name="OpenButton">
                        <div class="col-6 o_kanban_primary_left">
                            <button type="object" name="open_action" class="btn btn-primary">
                                <span>Open</span>
                            </button>
                        </div>
                    </t>

                    <t t-name="JournalTop">
                        <div t-attf-class="o_kanban_card_header">
                            <div class="o_kanban_card_header_title">
                                <div class="o_primary">
                                    <a type="report" name="open_action">
                                        <field name="name"/>
                                    </a>
                                </div>
                            </div>
                            <div class="o_kanban_manage_button_section">
                                <t t-if="button_type == 'mix' or button_type == 'report'"/>
                                <a class="o_kanban_manage_toggle_button" href="#"><i class="fa fa-ellipsis-v" aria-label="Selection" role="img" title="Selection"/></a>
                            </div>
                        </div>
                    </t>

                    <t t-name="ReportLook">
                        <div class="row">
                            <div class="col-4 o_kanban_card_manage_section o_kanban_manage_view">
                                <div class="o_kanban_card_manage_title">
                                    <span role="separator">Analysis</span>
                                </div>
                                <div t-if="journal_type == 'BS'">
                                    <a role="menuitem" name="open_page" context="{'page': 'Format'}" type="object">Format: 1 page/landscape</a>
                                </div>
                                <div>
                                    <a role="menuitem" name="open_action" type="object">Open report</a>
                                </div>
                            </div>
                            <div class="col-4 o_kanban_card_manage_section o_kanban_manage_view">
                                <div class="o_kanban_card_manage_title">
                                    <span role="separator">Download</span>
                                </div>
                                <div>
                                    <a role="menuitem" name="preview_pdf" type="object">Preview (PDF)</a>
                                </div>
                                <div>
                                    <a role="menuitem" name="download_xlsx" type="object">Export (XLSX)</a>
                                </div>
                            </div>
                        </div>

                        <div groups="account.group_account_manager" class="row o_kanban_card_settings">
                            <div class="col-6 text-left">
                                <a name="%(ohada_reports.action_ohada_financial_report_tree)d" type="action">Report settings</a>
                            </div>
                            <div class="col-6 text-right">
                                <a name="open_page" context="{'page': 'company'}" type="object">Company settings</a>
                            </div>
                        </div>

                        <t t-call="Settings"/>
                    </t>

                    <t t-name="MixLook">
                        <div class="row">
                            <div class="col-4 o_kanban_card_manage_section o_kanban_manage_view">
                                <div class="o_kanban_card_manage_title">
                                    <span role="separator">View</span>
                                </div>
                                <div t-if="journal_type == 'BS'">
                                    <a role="menuitem" name="open_page" context="{'page': 'Format'}" type="object">Format: 1 page/landscape</a>
                                </div>
                                <div>

                                </div>
                            </div>
                            <div class="col-4 o_kanban_card_manage_section o_kanban_manage_view">
                                <div class="o_kanban_card_manage_title">
                                    <span role="separator">Preset</span>
                                </div>
                                <div>
                                    <a role="menuitem" name="run_update_note_relevance" type="object">Update bundle/R4 settings</a>
                                </div>
                            </div>
                        </div>

                        <div groups="account.group_account_manager" class="row o_kanban_card_settings">
                            <div class="col-6 text-left">
                                <a t-if="widget.editable" name="%(ohada_reports.ohada_bundle_report_action)d" type="action">Bundle/R4 report settings</a>
                            </div>
                            <div class="col-6 text-right">
                                <a t-if="widget.editable" type="edit">Company settings</a>
                            </div>
                        </div>

                        <t t-call="Settings"/>
                    </t>

                    <t t-name="Settings">
                        <t t-call="Colors"/>
                        <div groups="account.group_account_manager" class="row o_kanban_card_settings">
                            <div class="col-6">
                                <field name="show_on_dashboard" widget="boolean_favorite" />
                            </div>
                            <div class="col-6 text-right">
                                <a t-if="widget.editable" type="edit">Dash settings</a>
                            </div>
                        </div>
                    </t>

                    <t t-name="Colors">
                        <div class="o_kanban_card_manage_settings row">
                            <div class="col-8">
                                <ul class="oe_kanban_colorpicker" data-field="color"/>
                            </div>
                        </div>
                    </t>

                    <t t-name="JournalManage">

                        <!-- For bank and cash -->
                        <div t-if="journal_type == 'BS'" class="row">
                            <div class="col-4 o_kanban_card_manage_section o_kanban_manage_view">
                                <div class="o_kanban_card_manage_title">
                                    <span role="separator">View</span>
                                </div>
                                <div>
                                    <a role="menuitem" type="object" name="open_action">Statements</a>
                                </div>
                                <div>
                                    <a role="menuitem" type="object" name="open_action_with_context" context="{'action_name': 'action_bank_statement_line', 'search_default_journal': True}">Operations</a>
                                </div>
                                <div>
                                    <a role="menuitem" type="object" name="open_collect_money">Customer Payments</a>
                                </div>
                                <div>
                                    <a role="menuitem" type="object" name="open_spend_money">Vendor Payments</a>
                                </div>
                                <div>
                                    <a role="menuitem" type="object" name="open_transfer_money">Internal Transfers</a>
                                </div>
                                <div>
                                    <a role="menuitem" type="object" name="open_action" context="{'action_name': 'action_account_moves_all_a'}" groups="base.group_no_one">Journal Items</a>
                                </div>
                            </div>

                            <div class="col-4 o_kanban_card_manage_section o_kanban_manage_new">
                                <div class="o_kanban_card_manage_title">
                                    <span role="separator">New</span>
                                </div>
                                <div name="bank_cash_commands">
                                    <t t-if="journal_type == 'BS'">
                                        <a role="menuitem" type="object" name="create_bank_statement">Statement</a>
                                    </t>
                                    <t t-if="journal_type == 'CF'">
                                        <a role="menuitem" type="object" name="create_cash_statement">Statement</a>
                                    </t>
                                </div>
                                <!-- <div>
                                    <a role="menuitem" type="object" name="create_customer_payment">Customer Payment</a>
                                </div>
                                <div>
                                    <a role="menuitem" type="object" name="create_supplier_payment">Vendor Payment</a>
                                </div>
                                <div>
                                    <a role="menuitem" type="object" name="create_internal_transfer">Internal Transfer</a>
                                </div> -->
                            </div>

                                <div class="col-4 o_kanban_card_manage_section o_kanban_manage_reconciliation">
                                <div class="o_kanban_card_manage_title">
                                    <span role="separator">Reconciliation</span>
                                </div>
                                <div>
                                    <a role="menuitem" type="object" name="open_action_with_context" context="{'action_name': 'action_account_reconcile_model', 'use_domain': ['|', ('match_journal_ids', '=', False), ('match_journal_ids', 'in', active_id)]}" groups="account.group_account_manager">Reconciliation Models</a>
                                </div>
                            </div>
                        </div>

                        <div t-if="journal_type == 'PL'" class="row">
                                <div class="col-4 o_kanban_card_manage_section o_kanban_manage_view">
                                <div class="o_kanban_card_manage_title">
                                    <span>View</span>
                                </div>
                                <div>
                                    <a t-if="journal_type == 'CF'" type="object" name="open_action" context="{'use_domain': [('type', '=', 'out_invoice')]}">Invoices</a>
                                    <a t-if="journal_type == 'PL'" type="object" name="open_action" context="{'use_domain': [('type', '=', 'in_invoice')]}">Bills</a>
                                </div>
                                <div>
                                    <a t-if="journal_type == 'CF'" type="object" name="open_action" context="{'use_domain': [('type', '=', 'out_refund')], 'invoice_type': 'refund'}">Credit Notes</a>
                                    <a t-if="journal_type == 'PL'" type="object" name="open_action" context="{'use_domain': [('type', '=', 'in_refund')], 'invoice_type': 'refund'}">Credit Notes</a>
                                </div>
                                <div>
                                    <a type="object" name="action_open_reconcile">Payments Matching</a>
                                </div>
                                <div>
                                    <a type="object" name="open_action" context="{'action_name': 'action_account_moves_all_a'}" groups="base.group_no_one">Journal Items</a>
                                </div>
                            </div>

                                <div class="col-4 o_kanban_card_manage_section o_kanban_manage_new">
                                <div class="o_kanban_card_manage_title">
                                    <span>New</span>
                                </div>
                                <div>
                                    <a type="object" name="action_create_new">
                                        <span t-if="journal_type == 'CF'">Invoice</span>
                                        <span t-if="journal_type == 'PL'">Bill</span>
                                    </a>
                                </div>
                                <div>
                                    <a type="object" name="action_create_new"  context="{'refund':True}">
                                        <span t-if="journal_type == 'CF'">Credit Note</span>
                                        <span t-if="journal_type == 'PL'">Credit Note Bill</span>
                                    </a>
                                </div>
                            </div>

                                <div class="col-4 o_kanban_card_manage_section o_kanban_manage_reports">
                                <div class="o_kanban_card_manage_title">
                                    <span>Reporting</span>
                                </div>
                                <div>
                                    <a t-if="journal_type == 'CF'" type="action" name="%(account.action_account_invoice_report_all)d" groups="account.group_account_manager">Invoices Analysis</a>
                                    <a t-if="journal_type == 'PL'" type="action" name="%(account.action_account_invoice_report_all_supp)d" groups="account.group_account_manager">Bills Analysis</a>
                                </div>
                            </div>
                        </div>

                        <!-- For general and situation -->
                        <div t-if="journal_type == 'CF'" class="row">
                                <div class="col-4 o_kanban_card_manage_section o_kanban_manage_view">
                                <div class="o_kanban_card_manage_title">
                                    <span>View</span>
                                </div>
                                <div>
                                    <a type="object" name="open_action" context="{'action_name': 'action_move_journal_line', 'view_no_maturity': 1}">Journal Entries</a>
                                </div>
                                <div>
                                    <a type="object" name="open_action" context="{'action_name': 'action_move_journal_line', 'search_default_unposted': 1, 'view_no_maturity': 1}">Entries to Review</a>
                                </div>
                                <div>
                                    <a type="object" name="open_action" context="{'action_name': 'action_account_moves_all_a'}" groups="base.group_no_one">Journal Items</a>
                                </div>
                            </div>

                                <div class="col-4 o_kanban_card_manage_section o_kanban_manage_new">
                                <div class="o_kanban_card_manage_title">
                                    <span>New</span>
                                </div>
                                <div>
                                    <a type="object" name="action_create_new">Journal Entry</a>
                                </div>
                            </div>

                                <div class="col-4 o_kanban_card_manage_section o_kanban_manage_operations">
                                <div class="o_kanban_card_manage_title">
                                    <span>Operations</span>
                                </div>
                                <div>
                                    <a type="object" name="open_action_with_context" context="{'action_name': 'action_validate_account_move', 'search_default_journal': True}">Post All Entries</a>
                                </div>
                            </div>
                        </div>

                        <div class="o_kanban_card_manage_settings row">
                            <div class="col-8">
                                <ul class="oe_kanban_colorpicker" data-field="color"/>
                            </div>
                        </div>

                        <div groups="account.group_account_manager" class="row o_kanban_card_settings">
                            <div class="col-6">
                                <field name="show_on_dashboard" widget="boolean_favorite" />
                            </div>
                            <div class="col-6 text-right">
                                <a t-if="widget.editable" type="edit">Settings</a>
                            </div>
                        </div>
                    </t>

                    <t t-name="JournalBS">
                        <div class="col-12 o_kanban_primary_right">
                            <div class="row">
                                <div class="col-7">
                                    <a type="object" name="open_action">
                                        <span>Assets - Liabilities <t t-esc="lines.this_year"/></span>
                                    </a>
                                </div>
                                <div class="col-5 text-right">
                                    <t t-esc="lines.this_year_value"/> <t t-esc="currency_symbol"/>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-7">
                                    <a type="object" t-if="journal_type == 'BS'" name="open_action">
                                        <span>Assets - Liabilities <t t-esc="lines.prev_year"/></span>
                                    </a>
                                </div>
                                <div class="col-5 text-right">
                                    <t t-esc="lines.prev_year_value"/> <t t-esc="currency_symbol"/>
                                </div>
                            </div>
                            <t t-call="VariationStr"/>
                        </div>
                    </t>
                    <t t-name="JournalPL">
                        <div class="col-12 o_kanban_primary_right">
                            <div class="row">
                                <div class="col-7">
                                    <a type="object" name="open_action">
                                        <span>Net profit <t t-esc="lines.this_year"/></span>
                                    </a>
                                </div>
                                <div class="col-5 text-right">
                                    <t t-esc="lines.this_year_value"/> <t t-esc="currency_symbol"/>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-7">
                                    <a type="object" t-if="journal_type == 'PL'" name="open_action">
                                        <span>Net profit <t t-esc="lines.prev_year"/></span>
                                    </a>
                                </div>
                                <div class="col-5 text-right">
                                    <t t-esc="lines.prev_year_value"/> <t t-esc="currency_symbol"/>
                                </div>
                            </div>
                            <t t-call="VariationStr"/>
                        </div>
                    </t>
                    <t t-name="JournalCF">
                        <div class="col-12 o_kanban_primary_right">
                            <div class="row">
                                <div class="col-7">
                                    <a type="object" name="open_action">
                                        <span>Cash closing balance <t t-esc="lines.this_year"/></span>
                                    </a>
                                </div>
                                <div class="col-5 text-right">
                                    <t t-esc="lines.this_year_value"/> <t t-esc="currency_symbol"/>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-7">
                                    <a type="object" t-if="journal_type == 'CF'" name="open_action">
                                        <span>Cash closing balance <t t-esc="lines.prev_year"/></span>
                                    </a>
                                </div>
                                <div class="col-5 text-right">
                                    <t t-esc="lines.prev_year_value"/> <t t-esc="currency_symbol"/>
                                </div>
                            </div>
                            <t t-call="VariationStr"/>
                        </div>
                    </t>
                    <t t-name="JournalBodyGraph">
                        <field name="kanban_dashboard_graph" graph_type="bar" widget="dashboard_graph"/>
                    </t>
                    <t t-name="VariationStr">
                        <div class="row">
                            <div class="col-7">
                                <a type="object" name="open_action"
                                id="account_dashboard_purchase_pay_link">
                                    Variation
                                </a>
                            </div>
                            <div class="col-5 text-right">
                                <t t-esc="lines.variation"/>
                            </div>
                        </div>
                    </t>
            </templates>
            </kanban>
        </field>
    </record>

    <record id="ohada_action_dash" model="ir.actions.act_window">
        <field name="name">Dashboard new</field>
        <field name="res_model">ohada.dash</field>
        <field name="view_type">form</field>
        <field name="view_mode">kanban,form</field>
        <field name="view_id" ref="ohada_dash_kanban_view"/>
    </record>

    <record id="ohada_action_dash_server" model="ir.actions.server">
        <field name="name">Dashboard new Server Action</field>
        <field name="model_id" ref="ohada_reports.model_ohada_dash"/>
        <field name="state">code</field>
        <field name="code">action = model.action_data()</field>
    </record>

    <menuitem
        id="menu_ohada_dash"
        action="ohada_action_dash_server"
        name="Dashboard new"
        parent="menu_ohada"
        sequence="1"/>
</odoo>

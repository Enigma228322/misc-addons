<odoo>
    <record id="ohada_dash_kanban_view" model="ir.ui.view">
        <field name="name">ohada.dash.dashboard.kanban</field>
        <field name="model">ohada.dash</field>
        <field name="arch" type="xml">
            <header>
                <button name="%(change_options_wizard)d" string="Change options" type="action" class="oe_highlight"/>
            </header>
            <kanban create="false" class="oe_background_grey o_kanban_dashboard o_account_kanban">
                <field name="id"/>
                <field name="name"/>
                <field name="type"/>
                <field name="color"/>
                <field name="report_id"/>
                <field name="report_type"/>
                <field name="show_on_dashboard"/>
                <field name="display_name"/>
                <field name="company_id"/>
                <field name="currency_id"/>
                <field name="dash_size"/>
                <field name="reports"/>
                <field name="current_year"/>
                <field name="bundle_reports"/>
                <field name="lines_value"/>
                <templates>
                    <t t-name="kanban-box">
                        <t t-value="JSON.parse(record.reports.raw_value)" t-set="reports_list"/>
                        <t t-value="JSON.parse(record.lines_value.raw_value)" t-set="lines"/>
                        <t t-value="record.name.raw_value" t-set="kanban_name"/>
                        <t t-value="JSON.parse(record.bundle_reports.raw_value)" t-set="main_reports"/>
                        <t t-value="record.dash_size.raw_value" t-set="dash_size"/>
                        <t t-value="record.type.raw_value" t-set="button_type"/>
                        <t t-value="record.current_year.raw_value" t-set="year"/>
                        <t t-value="record.company_id.value" t-set="company_name"/>
                        <t t-value="record.report_type.raw_value" t-set="journal_type"/>
                        <t t-value="record.currency_id.raw_value" t-set="currency_symbol"/>
                        <t t-value="record.reports.raw_value" t-set="report_ids"/>
                        <t t-value="record.display_name.raw_value" t-set="dashboard"/>
                        <t t-if="dash_size == 'middle'" t-call="MiddleSizeBox"/>
                        <t t-if="dash_size == 'small'" t-call="SmallSizeBox"/>
                        <t t-if="dash_size == 'large'" t-call="LargeSizeBox"/>
                        <!-- <t t-call="PrintBundlePoopup"/> -->
                    </t>

                    <t t-name="LargeSizeBox">
                        <div t-attf-class="#{kanban_color(record.color.raw_value)} col-12" style="width: 100%;">
                            <t t-call="JournalTop"/>
                            <div class="container o_kanban_card_content">
                                <div class="row">
                                    <t t-if="button_type == 'note_button'" t-call="NoteButtons"/>
                                    <t t-if="button_type == 'info_button'" t-call="Sheets"/>
                                    <t t-if="kanban_name == 'YourCompany'">
                                        <div class="col-md-4 col-lg-4" style="float:left;">
                                            <t t-call="ExportButtons"/>
                                        </div>
                                        <div class="col-md-4 col-lg-4" style="float:left;">
                                            <t t-call="CompanyLines"/>
                                        </div>
                                        <div class="col-md-4 col-lg-4" style="float:left;">
                                            <t t-call="CompanyStatus"/>
                                        </div>
                                    </t>
                                </div>
                            </div>
                            <div class="container o_kanban_card_manage_pane dropdown-menu" role="menu">
                                <t t-call="JournalManage"/>
                            </div>
                        </div>
                    </t>

                    <t t-name="MiddleSizeBox">
                        <div t-attf-class="#{kanban_color(record.color.raw_value)} col-6">
                            <t t-call="JournalTop"/>
                            <div class="container o_kanban_card_manage_pane dropdown-menu" role="menu">
                                <t t-call="JournalManage"/>
                            </div>
                        </div>
                    </t>

                    <t t-name="SmallSizeBox">
                        <div t-attf-class="#{kanban_color(record.color.raw_value)} col-4">
                            <t t-call="JournalTop"/>
                            <div class="container o_kanban_card_content">
                                <div class="row">
                                    <t t-if="journal_type == 'BS'">
                                        <t t-call="JournalBS"/>
                                        <t t-call="OpenButton"/>
                                    </t>
                                    <t t-if="journal_type == 'PL'">
                                        <t t-call="JournalPL"/>
                                        <t t-call="OpenButton"/>
                                    </t>
                                    <t t-if="journal_type == 'CF'">
                                        <t t-call="JournalCF"/>
                                        <t t-call="OpenButton"/>
                                    </t>
                                </div>
                                <t t-if="journal_type == 'BS' || journal_type == 'PL' || journal_type == 'CF'" t-call="JournalBodyGraph"/>
                            </div>
                            <div class="container o_kanban_card_manage_pane dropdown-menu" role="menu">
                                <t t-call="JournalManage"/>
                            </div>
                            <t t-call="JournalBodyGraph"/>
                        </div>
                    </t>

                    <t t-name="NoteButtons">
                        <t t-foreach="reports_list" t-as="note">
                            <div style="padding-bottom:20px; padding-left:6px;">
                                <button type="object" name="open_action_by_id" t-attf-data-context="{'id' : '#{note['id']}'}" style="min-width:125px;" class="btn btn-primary note">
                                    <span><t t-esc="note['name']"/></span>
                                </button>
                            </div>
                        </t>
                    </t>

                    <t t-name="Sheets">
                        <!-- <div class="col-6 o_kanban_primary_left"> -->
                        <div style="padding-bottom:20px; padding-left:6px;">
                            <button type="object" name="open_action" style="min-width:125px;" class="btn btn-primary">
                                <span>COVER PAGE</span>
                            </button>
                        </div>
                        <t t-foreach="reports_list" t-as="sheet">
                            <div style="padding-bottom:20px; padding-left:6px;">
                                <button type="object" name="open_action_by_id" t-attf-data-context="{'id' : '#{sheet['id']}'}" style="min-width:125px;" class="btn btn-primary note">
                                    <span><t t-esc="sheet['name']"/></span>
                                </button>
                            </div>
                        </t>
                        <!-- </div> -->
                    </t>

                    <t t-name="ExportButtons">
                        <div style="padding-bottom:20px; padding-left:6px;">
                            <button style="min-width:125px;" class="btn btn-primary export">
                                <span>PRINT BUNDLE</span>
                            </button>
                        </div>
                    </t>

                    <t t-name="CompanyLines">
                        <t t-foreach="lines['block_2']" t-as="line">
                            <div class="row">
                                <div class="col-7">
                                    <a type="object" name="open_action" style="overflow: visible;">
                                        <span><t t-esc="line['name']"/></span>
                                    </a>
                                </div>
                                <div class="col-5 text-right">
                                    <t t-esc="line['value']"/> <t t-esc="currency_symbol"/>
                                </div>
                            </div>
                        </t>
                    </t>

                    <t t-name="CompanyStatus">
                        <t t-debug="pdb"/>
                        <div class="row">
                            <div class="col-7">
                                <a type="object" name="open_action" style="overflow: visible;">
                                    <span>Status of fiscal year</span>
                                </a>
                            </div>
                            <div class="col-5 text-right">
                                <t t-esc="lines['period_lock_status']"/>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-7">
                                <a type="object" name="open_action" style="overflow: visible;">
                                    <span>Status of journal entries</span>
                                </a>
                            </div>
                            <div class="col-5 text-right">
                                <t t-esc="lines['unposted_in_period']"/>
                            </div>
                        </div>
                    </t>

                    <t t-name="OpenButton">
                        <div class="col-6 o_kanban_primary_left">
                            <button type="object" name="open_action" class="btn btn-primary">
                                <span>Open</span>
                            </button>
                        </div>
                    </t>

                    <t t-name="JournalTop">
                        <div t-attf-class="o_kanban_card_header">
                            <div class="o_kanban_card_header_title">
                                <div class="o_primary">
                                    <a type="report" name="open_action"><field name="name"/></a>
                                </div>
                            </div>
                            <div class="o_kanban_manage_button_section">
                                <a class="o_kanban_manage_toggle_button" href="#"><i class="fa fa-ellipsis-v" aria-label="Selection" role="img" title="Selection"/></a>
                            </div>
                        </div>
                    </t>

                    <t t-name="JournalManage">

                        <!-- For bank and cash -->
                        <div t-if="journal_type == 'BS'" class="row">
                                <div class="col-4 o_kanban_card_manage_section o_kanban_manage_view">
                                <div class="o_kanban_card_manage_title">
                                    <span role="separator">View</span>
                                </div>
                                <div>
                                    <a role="menuitem" type="object" name="open_action">Statements</a>
                                </div>
                                <div>
                                    <a role="menuitem" type="object" name="open_action_with_context" context="{'action_name': 'action_bank_statement_line', 'search_default_journal': True}">Operations</a>
                                </div>
                                <div>
                                    <a role="menuitem" type="object" name="open_collect_money">Customer Payments</a>
                                </div>
                                <div>
                                    <a role="menuitem" type="object" name="open_spend_money">Vendor Payments</a>
                                </div>
                                <div>
                                    <a role="menuitem" type="object" name="open_transfer_money">Internal Transfers</a>
                                </div>
                                <div>
                                    <a role="menuitem" type="object" name="open_action" context="{'action_name': 'action_account_moves_all_a'}" groups="base.group_no_one">Journal Items</a>
                                </div>
                            </div>

                                <div class="col-4 o_kanban_card_manage_section o_kanban_manage_new">
                                <div class="o_kanban_card_manage_title">
                                    <span role="separator">New</span>
                                </div>
                                <div name="bank_cash_commands">
                                    <t t-if="journal_type == 'BS'">
                                        <a role="menuitem" type="object" name="create_bank_statement">Statement</a>
                                    </t>
                                    <t t-if="journal_type == 'CF'">
                                        <a role="menuitem" type="object" name="create_cash_statement">Statement</a>
                                    </t>
                                </div>
                                <div>
                                    <a role="menuitem" type="object" name="create_customer_payment">Customer Payment</a>
                                </div>
                                <div>
                                    <a role="menuitem" type="object" name="create_supplier_payment">Vendor Payment</a>
                                </div>
                                <div>
                                    <a role="menuitem" type="object" name="create_internal_transfer">Internal Transfer</a>
                                </div>
                            </div>

                                <div class="col-4 o_kanban_card_manage_section o_kanban_manage_reconciliation">
                                <div class="o_kanban_card_manage_title">
                                    <span role="separator">Reconciliation</span>
                                </div>
                                <div>
                                    <a role="menuitem" type="object" name="open_action_with_context" context="{'action_name': 'action_account_reconcile_model', 'use_domain': ['|', ('match_journal_ids', '=', False), ('match_journal_ids', 'in', active_id)]}" groups="account.group_account_manager">Reconciliation Models</a>
                                </div>
                            </div>
                        </div>

                        <div t-if="journal_type == 'PL'" class="row">
                                <div class="col-4 o_kanban_card_manage_section o_kanban_manage_view">
                                <div class="o_kanban_card_manage_title">
                                    <span>View</span>
                                </div>
                                <div>
                                    <a t-if="journal_type == 'CF'" type="object" name="open_action" context="{'use_domain': [('type', '=', 'out_invoice')]}">Invoices</a>
                                    <a t-if="journal_type == 'PL'" type="object" name="open_action" context="{'use_domain': [('type', '=', 'in_invoice')]}">Bills</a>
                                </div>
                                <div>
                                    <a t-if="journal_type == 'CF'" type="object" name="open_action" context="{'use_domain': [('type', '=', 'out_refund')], 'invoice_type': 'refund'}">Credit Notes</a>
                                    <a t-if="journal_type == 'PL'" type="object" name="open_action" context="{'use_domain': [('type', '=', 'in_refund')], 'invoice_type': 'refund'}">Credit Notes</a>
                                </div>
                                <div>
                                    <a type="object" name="action_open_reconcile">Payments Matching</a>
                                </div>
                                <div>
                                    <a type="object" name="open_action" context="{'action_name': 'action_account_moves_all_a'}" groups="base.group_no_one">Journal Items</a>
                                </div>
                            </div>

                                <div class="col-4 o_kanban_card_manage_section o_kanban_manage_new">
                                <div class="o_kanban_card_manage_title">
                                    <span>New</span>
                                </div>
                                <div>
                                    <a type="object" name="action_create_new">
                                        <span t-if="journal_type == 'CF'">Invoice</span>
                                        <span t-if="journal_type == 'PL'">Bill</span>
                                    </a>
                                </div>
                                <div>
                                    <a type="object" name="action_create_new"  context="{'refund':True}">
                                        <span t-if="journal_type == 'CF'">Credit Note</span>
                                        <span t-if="journal_type == 'PL'">Credit Note Bill</span>
                                    </a>
                                </div>
                            </div>

                                <div class="col-4 o_kanban_card_manage_section o_kanban_manage_reports">
                                <div class="o_kanban_card_manage_title">
                                    <span>Reporting</span>
                                </div>
                                <div>
                                    <a t-if="journal_type == 'CF'" type="action" name="%(account.action_account_invoice_report_all)d" groups="account.group_account_manager">Invoices Analysis</a>
                                    <a t-if="journal_type == 'PL'" type="action" name="%(account.action_account_invoice_report_all_supp)d" groups="account.group_account_manager">Bills Analysis</a>
                                </div>
                            </div>
                        </div>

                        <!-- For general and situation -->
                        <div t-if="journal_type == 'CF'" class="row">
                                <div class="col-4 o_kanban_card_manage_section o_kanban_manage_view">
                                <div class="o_kanban_card_manage_title">
                                    <span>View</span>
                                </div>
                                <div>
                                    <a type="object" name="open_action" context="{'action_name': 'action_move_journal_line', 'view_no_maturity': 1}">Journal Entries</a>
                                </div>
                                <div>
                                    <a type="object" name="open_action" context="{'action_name': 'action_move_journal_line', 'search_default_unposted': 1, 'view_no_maturity': 1}">Entries to Review</a>
                                </div>
                                <div>
                                    <a type="object" name="open_action" context="{'action_name': 'action_account_moves_all_a'}" groups="base.group_no_one">Journal Items</a>
                                </div>
                            </div>

                                <div class="col-4 o_kanban_card_manage_section o_kanban_manage_new">
                                <div class="o_kanban_card_manage_title">
                                    <span>New</span>
                                </div>
                                <div>
                                    <a type="object" name="action_create_new">Journal Entry</a>
                                </div>
                            </div>

                                <div class="col-4 o_kanban_card_manage_section o_kanban_manage_operations">
                                <div class="o_kanban_card_manage_title">
                                    <span>Operations</span>
                                </div>
                                <div>
                                    <a type="object" name="open_action_with_context" context="{'action_name': 'action_validate_account_move', 'search_default_journal': True}">Post All Entries</a>
                                </div>
                            </div>
                        </div>

                        <div class="o_kanban_card_manage_settings row">
                            <div class="col-8">
                                <ul class="oe_kanban_colorpicker" data-field="color"/>
                            </div>
                        </div>

                        <div groups="account.group_account_manager" class="row o_kanban_card_settings">
                            <div class="col-6">
                                <field name="show_on_dashboard" widget="boolean_favorite" />
                            </div>
                            <div class="col-6 text-right">
                                <a t-if="widget.editable" type="edit">Settings</a>
                            </div>
                        </div>
                    </t>

                    <t t-name="JournalBS">
                        <div class="col-7 o_kanban_primary_right">
                            <div class="row">
                                <div class="col-7">
                                    <a type="object" name="open_action" style="overflow: visible;">
                                        <span>Assets - Liabilities <t t-esc="lines.this_year"/></span>
                                    </a>
                                </div>
                                <div class="col-5 text-right">
                                    <t t-esc="lines.this_year_value"/> <t t-esc="currency_symbol"/>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-7">
                                    <a type="object" t-if="journal_type == 'BS'" name="open_action" style="overflow: visible;">
                                        <span>Assets - Liabilities <t t-esc="lines.prev_year"/></span>
                                    </a>
                                </div>
                                <div class="col-5 text-right">
                                    <t t-esc="lines.prev_year_value"/> <t t-esc="currency_symbol"/>
                                </div>
                            </div>
                            <t t-call="VariationStr"/>
                        </div>
                    </t>
                    <t t-name="JournalPL">
                        <div class="col-7 o_kanban_primary_right">
                            <div class="row">
                                <div class="col-7">
                                    <a type="object" name="open_action">
                                        <span>Net profit <t t-esc="lines.this_year"/></span>
                                    </a>
                                </div>
                                <div class="col-5 text-right">
                                    <t t-esc="lines.this_year_value"/> <t t-esc="currency_symbol"/>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-7">
                                    <a type="object" t-if="journal_type == 'PL'" name="open_action">
                                        <span>Net profit <t t-esc="lines.prev_year"/></span>
                                    </a>
                                </div>
                                <div class="col-5 text-right">
                                    <t t-esc="lines.prev_year_value"/> <t t-esc="currency_symbol"/>
                                </div>
                            </div>
                            <t t-call="VariationStr"/>
                        </div>
                    </t>
                    <t t-name="JournalCF">
                        <div class="col-7 o_kanban_primary_right">
                            <div class="row">
                                <div class="col-7">
                                    <a type="object" name="open_action" style="overflow: visible;">
                                        <span>Cash closing balance <t t-esc="lines.this_year"/></span>
                                    </a>
                                </div>
                                <div class="col-5 text-right">
                                    <t t-esc="lines.this_year_value"/> <t t-esc="currency_symbol"/>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-7">
                                    <a type="object" t-if="journal_type == 'CF'" name="open_action" style="overflow: visible;">
                                        <span>Cash closing balance <t t-esc="lines.prev_year"/></span>
                                    </a>
                                </div>
                                <div class="col-5 text-right">
                                    <t t-esc="lines.prev_year_value"/> <t t-esc="currency_symbol"/>
                                </div>
                            </div>
                            <t t-call="VariationStr"/>
                        </div>
                    </t>
                    <t t-name="JournalBodyGraph">
                        <!-- <field name="kanban_dashboard_graph" t-att-graph_type="_.contains(['cash','bank'],journal_type) ? 'line' : 'bar'" widget="dashboard_graph"/> -->
                        <field name="kanban_dashboard_graph" graph_type="bar" widget="dashboard_graph"/>
                    </t>
                    <t t-name="VariationStr">
                        <div class="row">
                            <div class="col-7">
                            <!-- Change name="open_action" to another action -->
                                <a type="object" name="open_action"
                                id="account_dashboard_purchase_pay_link">
                                    Variation
                                </a>
                            </div>
                            <div class="col-5 text-right">
                                n/a
                            </div>
                        </div>
                    </t>

                    <t t-name="PrintBundlePoopup">
                        <div id="myForm" class="popup disp-block">
                            <div class="modal-header">
                                <h5 class="modal-title">Print bundle report</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-label="Close">&amp;times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <p style="color:#008784;">Company: <span style="color:#666666;"><t t-esc="company_name"/></span></p>
                                <p style="color:#008784;">Fiscal year: <span style="color:#666666;"><t t-esc="year"/></span></p>
                                <t t-foreach="main_reports.result" t-as="report">
                                    <div class="form-check bundle_item">
                                        <input t-att-data-record-id="report['id']" class="form-check-input" type="checkbox" id="gridCheck1" t-att-checked="True"/>
                                        <label class="form-check-label" for="gridCheck1">
                                        <t t-esc="report['name']"/>
                                        </label>
                                    </div>
                                </t>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-primary export_pdf" data-dismiss="modal">Export pdf</button>
                                <button type="button" class="btn btn-primary export_xlsx" data-dismiss="modal">Export xlsx</button>
                            </div>
                        </div>
                    </t>
            </templates>
            </kanban>
        </field>
    </record>

    <record id="ohada_action_dash" model="ir.actions.act_window">
        <field name="name">Dashboard new</field>
        <field name="res_model">ohada.dash</field>
        <field name="view_type">form</field>
        <field name="view_mode">kanban,form</field>
        <field name="view_id" ref="ohada_dash_kanban_view"/>
    </record>

    <menuitem
        id="menu_ohada_dash"
        action="ohada_action_dash"
        name="Dashboard new"
        parent="menu_ohada"
        sequence="1"/>
</odoo>
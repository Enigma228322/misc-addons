<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="action_deal" model="ir.actions.act_window">
        <field name="name">Deals</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">sale.deal</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
        <field name="context">{}</field>
        <field name="help" type="html">
            <p class="oe_view_nocontent_create">
                Create a new Deal.
            </p>
        </field>
    </record>
    
    <menuitem id="menu_deal" action="action_deal" parent="sale.sale_order_menu" sequence="13"/>

    <record id="view_deal_tree" model="ir.ui.view">
        <field name="name">sale.deal.tree</field>
        <field name="model">sale.deal</field>
        <field name="arch" type="xml">
            <tree string="Deal" create="false">
                <field name="name"/>
                <field name="sale_order_id"/>
            </tree>
        </field>
    </record>

    <record id="view_deal_form" model="ir.ui.view">
        <field name="name">sale.deal.form</field>
        <field name="model">sale.deal</field>
        <field name="arch" type="xml">
            <form string="Deal" create="false">
                <sheet>
                    <group>
                        <field name="name"/>
                        <field name="sale_order_id" readonly="1"/>
                    </group>
                    <notebook>
                        <page string="Attachments">
                            <field name="attachment_ids">
                                <form string="Attachments">
                                    <field name="name"/>
                                    <field name="file_ids" mode="kanban">
                                        <kanban string="Deal Attachments">
                                            <field name="name"/>
                                            <field name="file"/>
                                            <templates>
                                                <t t-name="kanban-box">
                                                    <div class="oe_kanban_global_click">
                                                        <a t-if="!read_only_mode" type="delete" class="fa fa-times pull-right"/>
                                                        <div class="o_kanban_image">
                                                            <img t-if="record.file.raw_value" t-att-src="'data:image/png;base64,'+record.file.raw_value"/>
                                                        </div>
                                                        <div class="oe_kanban_details">
                                                            <field name="name"/>
                                                        </div>
                                                    </div>
                                                </t>
                                            </templates>
                                        </kanban>
                                    </field>
                                </form>
                                <tree>
                                    <field name="name"/>
                                </tree>
                            </field>
                        </page>
                        <page string="Trade In">
                            <field name="trade_in_mu_ids" domain="[('form','!=', 'new')]">
                                <tree>
                                    <field name="name"/>
                                    <field name="standard_price"/>
                                    <field name="payoffs"/>
                                    <field name="trade_equity" sum="Total Trade Equity"/>
                                </tree>
                            </field>
                        </page>
                        <page string="Financing and Insurance">
                            <group>
                                <group>
                                    <field name="loan_term"/>
                                    <field name="days_first"/>
                                    <field name="ballon_term"/>
                                    <field name="apr"/>
                                    <field name="dealer_rate"/>
                                    <field name="payment_previous"/>
                                    <field name="payment_down"/>
                                    <field name="trade_equity"/>
                                </group>
                                <group>
                                    <field name="total_cash_price"/>
                                    <field name="total_down"/>
                                    <field name="total_to_finance"/>
                                    <field name="total_apr"/>
                                    <field name="payment"/>
                                </group>
                            </group>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
            </form>
        </field>
    </record>

    <record model="ir.ui.view" id="view_sale_deal_attachment_file_form">
        <field name="name">sale.deal.attachment.file.form</field>
        <field name="model">sale.deal.attachment.file</field>
        <field name="arch" type="xml">
            <form string="Attachment File">
                <sheet>
                    <field name="file" widget="image" class="oe_avatar" media="True"/>
                    <field name="media_type" invisible="1"/>
                    <field name="media_video_ID" invisible="1"/>
                    <field name="media_video_service" invisible="1"/>
                    <div class="oe_title">
                        <label class="oe_edit_only" for="name" string="File Name"/>
                        <h1><field name="name" placeholder="File Name" required="True"/></h1>
                        <field name="attachment_id" invisible="1"/>
                    </div>
                </sheet>
            </form>
        </field>
    </record>

    <record id="action_deals_open" model="ir.actions.act_window">
        <field name="name">Open Deals</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">sale.deal</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('sale_order_id.state', 'in', ('draft', 'sent'))]</field>
        <field name="context">{}</field>
        <field name="help" type="html">
            <p class="oe_view_nocontent_create">
                Create a new Deal.
            </p>
        </field>
    </record>

    <record id="action_deals_month" model="ir.actions.act_window">
        <field name="name">This Month's Deals</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">sale.deal</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('sale_order_id.date_order', '&gt;=', context_today().strftime("%Y-%m-1"))]</field>
        <field name="context">{}</field>
        <field name="help" type="html">
            <p class="oe_view_nocontent_create">
                Create a new Deal.
            </p>
        </field>
    </record>

    <menuitem id="sale.marketing" name="Marketing" parent="sale.sale_menu_root" sequence="4"/>
    <menuitem id="sale.finance" name="F &amp; I" parent="sale.sale_menu_root" sequence="4"/>
    <menuitem id="deals_open" action="action_deals_open" parent="sale.finance" sequence="1"/>
    <menuitem id="deals_month" action="action_deals_month" parent="sale.marketing" sequence="1"/>

</odoo>
